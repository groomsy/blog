<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    The development homepage for Todd Grooms
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1>GroomsyDev</h1>
        <p class="lead">This homepage is for the development related musings of <a href="http://toddgrooms.com">Todd Grooms</a>.</p>

        <div class="colophon">
          <h4>Projects</h4>
          <ul class="colophon-links">
            <li>
              <a href="scenic/">Scenic</a>
            </li>
          </ul>
          
          <ul class="colophon-links">
            <h4>Site Index</h4>
            <li>
              <a href="/index.html">Home</a>
            </li>
            <li>
              <a href="/setup">Environment Setup</a>
            </li>
            <li>
              <a href="https://github.com/groomsy">GitHub Profile</a>
            </li>
            <li>Currently v0.0.1</li>
          </ul>
          <p>&copy; 2014. Todd Grooms All rights reserved.</p>
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1>
      <a href="/2014/06/18/unintuitive-swift/">
        Unintuitive Swift
      </a>
    </h1>

    <span class="post-date">18 Jun 2014</span>

    <p>In case you have been living under a rock, Apple announced a new language at this year's WWDC: Swift. I have been anxious to work with the new language beyond reading the Apple supplied <a href="https://itunes.apple.com/us/book/swift-programming-language/id881256329?mt=11">The Swift Programming Language</a> and the new Playground Xcode feature (which is a new way to experiment with Swift without using it in a project). I have recently been working on a new personal project (I am not ready to talk in great detail at this time, but it is a Mac application) and since the project is still in it's early stages, I decided to convert the project over and start using Swift in this project. Converting the project went smoothly and developers have the benefit of mixing and matching between Swift and Objective-C. I currently have a couple of classes written in Swift that play along nicely with the rest of my Objective-C code. I was skeptical when this capability was announced, but so far it has been working as Apple advertised.</p>

<p>This morning, I was writing some Swift code to validate the input in an <code>NSTextField</code> as it is typed by the user. I am attempting to validate the input as what I perceive to be a valid time format: <code>"s"</code>, <code>"ss"</code>, <code>"m:ss"</code>, <code>"mm:ss"</code>, <code>"h:mm:ss"</code>, or <code>"hh:mm:ss"</code>. In my initial implementation, I wanted to validate that only numbers and colons were input, to break apart the given string into components (with the token being the colon), and to assess each time component to ensure each component was an acceptable length. I am going to step through each one of these tasks and show what it would look like in Objective-C and what the equivalent looks like in Swift (or at least, to what it looks like in Swift to the best of my knowledge at this time; There may be more efficient ways of doing these tasks in Swift that I am not aware of yet). I'm also going to rant a bit about some things that I found confusing in my Swift implementation.</p>

<h3>Validating a String's CharacterSet</h3>

<p>Given a string, I want to know whether or not the given string contains any forbidden characters. Given <code>"07:07"</code>, the result would be <code>false</code> (does not contain forbidden characters); Given <code>"07.07"</code>, the result would be <code>true</code> (does contain forbidden characters).</p>

<h4>Objective-C</h4>

<pre><code>NSString *timeString = @"07:07";

NSCharacterSet *validTimeCharacterSet = [NSCharacterSet characterSetWithCharactersInString:@"0123456789:"];
NSCharacterSet *invalidTimeCharacterSet = [validTimeCharacterSet invertedSet];
NSRange rangeOfInvalidTimeCharacters = [timeString rangeOfCharacterFromSet:invalidTimeCharacterSet];
BOOL invalidTime = rangeOfInvalidTimeCharacters.location != NSNotFound;
</code></pre>

<h4>Swift</h4>

<p>So there are a few caveats with this solution in Swift. Swift has a <code>Range</code> class that does not directly map to the <code>NSRange</code> structure. I, for the life of me, could not figure out how <code>Range</code> actually works. Furthermore, Swift's String class does not have a simple <code>rangeOfCharacterFromSet:</code> function (or it's equivalent); Instead, it has a <code>rangeOfCharacterFromSet(aSet: NSCharacterSet, options: NSStringCompareOptions, range: Range)</code> function. I tried many things, but could not get <code>Range</code> to behave as I thought it would. I realize this has to do with how I think of <code>NSRange</code> and I am trying to just use <code>NSRange</code> in Swift, but I found it very confusing. After hunting through the developer forums, this is the solution I came up with:</p>

<pre><code>let timeString = "07:07" as NSString

let validTimeCharacterSet = NSCharacterSet(charactersInString: "0123456789:")
let invalidTimeCharacterSet = validTimeCharacterSet.invertedSet
let rangeOfInvalidCharacters = timeString.rangeOfCharacterFromSet(invalidTimeCharacterSet)
let invalidTime = rangeOfInvalidCharacters.location != NSNotFound
</code></pre>

<p>or</p>

<pre><code>let timeString = "07:07"

let validTimeCharacterSet = NSCharacterSet(charactersInString: "0123456789:")
let invalidTimeCharacterSet = validTimeCharacterSet.invertedSet
let rangeOfInvalidCharacters = timeString.bridgeToObjectiveC().rangeOfCharacterFromSet(invalidTimeCharacterSet)
let invalidTime = rangeOfInvalidCharacters.location != NSNotFound
</code></pre>

<h3>Breaking a String into Components</h3>

<p>Given a delimited string, I want an array of strings for each component. Given <code>"mm:ss"</code>, the result would be <code>["mm", "ss"]</code>.</p>

<h4>Objective-C</h4>

<pre><code>NSString *timeString = @"07:07";
NSArray *timeComponents = [timeString componentsSeparatedByString:@":"];
</code></pre>

<h4>Swift</h4>

<pre><code>let timeString = "07:07"
let timeComponents = timeString.componentsSeparatedByString(":")
</code></pre>

<h3>Iterating Over an Array Backwards</h3>

<p>I will not bore you with the details on how to iterate over an array backwards in Objective-C. That really is not important in this observation. The real quirk is how you iterate over an array backwards in Swift. In Swift, you can iterate with a <code>for-in</code> loop:</p>

<pre><code>for index in 0...3 {
  println(index)
}
</code></pre>

<p>The above code will loop four times (the <code>...</code> in this case indicates inclusive, meaning <code>&lt;= 3</code>; If you wanted to be exclusive, meaning <code>&lt; 3</code>, use <code>..</code> instead). Using my prior knowledge of Ruby, which has a similar <code>for</code> loop structure, I assumed that performing this loop in a reverse order would look like:</p>

<pre><code>for index in 3...0 {
  println(index)
}
</code></pre>

<p>After watching the loop run for a few seconds, I realized how my assumption was false. My code was iterating many, many times. Have you seen the issue yet? Well, Swift is iterating from 3 to 0, incrementing. The loop starts at 3, then moves to 4, then to 5, 6, 7, and so on. Given enough time, <code>index</code> (which is an <code>Int64</code> on my 64-bit Mac) will overflow into negative numbers, then slowly work it's way to zero. I found this to be fascinating. I am not going to say this is a defect, but I will say that I believe this is misleading behavior, given prior experience with other languages. I would have expected the above code to start at 3 and work it's way down to 0.</p>

<p>I could have used my time here to complain about this, but I will not. This has been talked about on the developer forums, so I will not add to it here. After some digging, I did find a way of accomplishing this task:</p>

<pre><code>for index in reverse(0...3) {
  println(index)
}
</code></pre>

<p>Ah, of course: The intuitive <code>reverse()</code> function. How could I have missed that?</p>

<h3>What I Learned</h3>

<p>I have much to learn when it comes to Swift. It does not help that the language will be evolving while learning, but it makes sense to learn it early (in my opinion) so that I understand what my platform is moving toward. I am coming up on nearly five years of iOS experience and the code I am writing in Swift now makes me cringe. It makes me feel like I am in college again, writing terrible code. Have you ever looked back at code you have wrote while in college? Welcome to learning Swift.</p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2014/04/09/introducing-core-data-mate/">
        Introducing CoreDataMate
      </a>
    </h1>

    <span class="post-date">09 Apr 2014</span>

    <p>A few years ago, I started development on a project that required long term persistence. Up until that point, most all of my persistence was handled on the server. This project required that I persist data locally on the user's device, in conjunction with persisting data remotely on a server. As this was an iOS project and Apple is "all-in" with Core Data, I decided I had better get "all-in" with Core Data as well.</p>

<p>I read through every Core Data tutorial I could find on the internet. Regardless of how many times I tried, I just could not grasp what was happening in Core Data. After complaining about this to some of my coworkers, I had a few of them recommend <a href="https://github.com/magicalpanda/MagicalRecord">MagicalRecord</a>. I am not going to question the quality of this library; I have no doubt that it is well written and works as advertised. The issue is that I don't understand what the library is doing behind the curtain. I use libraries all the time, but when I use them, I want to understand what they are doing (more or less) without blindly trusting them. For whatever reason, I simply cannot wrap my head around what MagicalRecord is doing. It seems as though you can arbitrarily create objects on any context and save them. This is one of the library's goals. However, one thing I have come to understand is that you need to ensure that every thread has it's very own context so that you don't "cross the streams" so to speak. Try as I might, I simply could not ensure this using MagicalRecord. This is when I decided to go old school and purchase a book: <a href="http://pragprog.com/book/mzcd2/core-data">Core Data (2nd Edition): Data Storage and Management for iOS, OS X, and iCloud</a>.</p>

<p><img src="/images/dont_cross_the_streams.jpg" alt="Don't cross the streams" /></p>

<p>After reading through <em>Core Data (2nd Edition)</em>, I started writing what I called a "data manager". The data manager is a simple class that acts as a gateway to your persistent store. The data manager houses a private context which is considered to be the master copy. You do not have direct access to this context from any public facing methods in the data manager. The context that you work with predominantly will be a child context of the private context. This child context is a main queue context that I have appropriately named <code>mainContext</code>. The main queue context will be the context that you predominantly work with. This is the context with which your UI will directly interact.</p>

<p>This is all great, except for the very real use case when you will need to write content to your persistent store. What then? Well, the data manager's current pattern dictates that you create a new temporary context for your thread (this can even be the main thread if you like, the point is that you just want a temporary context with which to work) whose parent will be the data manager's <code>mainContext</code>; you will then make any changes that are necessary on this temporary context. After you are finished, you'll persist your temporary context which will write those changes upstream to the data manager's <code>mainContext</code>. If that persist is successful, simply call:</p>

<pre><code>[[CDMDataManager sharedManager] persist:YES];
</code></pre>

<p>which will write the <code>mainContext</code>'s changes upstream to the data manager's private context (the BOOL value indicates that it should be a synchronous save; a NO here would result in an asynchronous save). At that point, your new content is in your persistent store and you have the added benefit of your UI already being updated with this content as your changes already exist on the <code>mainContext</code>.</p>

<p>This is a rudimentary example, but I wanted to show how easy Core Data can be to work with, with a bit of caution and understanding. Ready to check out the source code or give it a spin yourself? Head on over to <a href="https://github.com/groomsy/coredatamate">CoreDataMate on Github</a> to check out the source. If you're impatient and want to play with the code (and you use <a href="http://cocoapods.org">Cocoapods</a>) just add this to your Podfile: <code>pod "CoreDataMate"</code>.</p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2014/03/28/hello-world/">
        Hello, world!
      </a>
    </h1>

    <span class="post-date">28 Mar 2014</span>

    <p>Welcome to <a href="http://groomsydev.org">GroomsyDev</a>. This is the development related companion site to <a href="http://toddgrooms.com">toddgrooms.com</a>.</p>

<p>Feel free to peruse my <a href="https://github.com/groomsy">Github projects</a>.</p>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <span class="next">Older</span>
  
  
    <span class="previous">Newer</span>
  
</div>
    </div>

  </body>
</html>
